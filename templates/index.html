<!-- templates/index.html -->
<!DOCTYPE html>
<html>
    <head>
        <title>PurplePswd - Password Generator</title>
        <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    </head>
    <body>
        <div class="card">
        <h1>PURPLEPSWD</h1>
        Enter minimum and maximum password length and get your ideal password in zero time.<br>
        <br>

        Minimum: <input type="number" id="min_length" value="8"><br>
        Maximum: <input type="number" id="max_length" value="12">
        <label>
            <input type="checkbox" id="symbols" checked>Symbols
        </label>
        <button onclick="generate()">Generate</button>
        

        <div class="output"><!-- Generated password -->
                <input type="text" id="result" readonly>
            </div>
            <br>
            <!-- Slice controls -->
            <div class="slice-section">

                <div class="slice-row">
                    <span class="slice-label">Slice from</span>
                    <input type="number" id="sliceStart" value="0">

                    <span class="slice-label">to</span>
                    <input type="number" id="sliceEnd">

                    <button onclick="slicePassword()">Slice</button>
                </div>

                <input type="text" id="slicedPassword" readonly>

                <button onclick="copySliced()">Copy</button>

                </div>


            <!-- Toast -->
            <div id="toast"></div>

        <script>
        function generate() {
            fetch("/generate", {
                method: "POST",
                headers: {"Content-Type": "application/json"},
                body: JSON.stringify({
                    min_length: document.getElementById("min_length").value,
                    max_length: document.getElementById("max_length").value,
                    symbols: document.getElementById("symbols").checked
                })
            })
            .then(res => res.json())
            .then(data => {
                document.getElementById("result").value = data.password;
                document.getElementById("sliceStart").value = 0;
                document.getElementById("sliceEnd").value = data.password.length;
            });
        }

        function slicePassword() {
            const pwd = document.getElementById("result").value;
            const start = Number(document.getElementById("sliceStart").value);
            const end = Number(document.getElementById("sliceEnd").value);

            if (!pwd) {
                showToast("Generate password first");
                return;
            }

            if (start < 0 || end > pwd.length || start >= end) {
                showToast("Invalid slice range");
                return;
            }

            document.getElementById("slicedPassword").value =
                pwd.slice(start, end);
        }

        function copySliced() {
            const text = document.getElementById("slicedPassword").value;

            if (!text) {
                showToast("Nothing to copy");
                return;
            }

            navigator.clipboard.writeText(text)
                .then(() => showToast("Copied to clipboard"));
        }

            let toastTimer;

            function showToast(msg) {
            const toast = document.getElementById("toast");

            clearTimeout(toastTimer); // cancel previous hide

            toast.innerText = msg;
            toast.className = "show";

            toastTimer = setTimeout(() => {
                toast.className = "";
            }, 2000);
            }

        </script>

    </body>
</html>

